import{b as d,g as Z,_ as ee}from"./index.682428fc.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css              *//* empty css              */import{d as te,e as _,aW as ae,bn as ne,bc as oe,bi as le,b2 as ue,C as se,aI as a,aG as l,aH as ie,a$ as S,B as de,F as g,aM as r,u as L,bh as re,be as ce,bj as me,b9 as pe,ba as fe}from"./arco.572a1b40.js";import{E as H}from"./Editor.ad7f6e41.js";import{h as _e}from"./vue.adf857d5.js";import"./chart.f83c6245.js";const ve=I=>(pe("data-v-4ff007ef"),I=I(),fe(),I),he={class:"container"},ge=ve(()=>g("p",null,"\u7AE0\u8282\u8BE6\u60C5",-1)),we={style:{marginLeft:"40px",marginRight:"40px"}},be={style:{marginLeft:"80px"}},Ce={style:{marginLeft:"80px"}},Ie={style:{marginLeft:"80px"}},ye={style:{marginLeft:"80px"}},Ee={style:{marginLeft:"80px"}},Fe=["innerHTML"],Ne=te({__name:"chapterDetailEdit",setup(I){const i=_e(),D={pageSize:5},R=[{title:"ID",dataIndex:"id"},{title:"\u540D\u79F0",dataIndex:"title"},{title:"\u5185\u5BB9",dataIndex:"content"},{title:"\u63CF\u8FF0",dataIndex:"desc"},{title:"\u4FEE\u6539",slotName:"edit",width:80},{title:"\u5220\u9664",slotName:"delete",width:80}],u=_({id:0,title:"",desc:"",content:""}),f=_([]),w=_(!1),x=_(!1),O=()=>{w.value=!0,x.value=!0},z=(n,e,o,t)=>{w.value=!0,x.value=!1,u.value.id=n,u.value.title=e,u.value.content=o,u.value.desc=t},T=async function(n){for(let o=0;o<f.value.length;o+=1)f.value[o].id===n&&f.value.splice(o,1);const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(n)};await d.post("admin/lesson/content/del",e)},U=async function(){if(x.value){const n={title:u.value.title,desc:u.value.desc,content:u.value.content},o=(await d.post("/admin/richtext/add",n)).data.id,t={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(o),resource_index:0};await d.post("/admin/lesson/content/add",t),f.value.push({id:o,title:u.value.title,desc:u.value.desc,content:u.value.content})}else{for(let e=0;e<f.value.length;e+=1)f.value[e].id===u.value.id&&(f.value[e].title=u.value.title,f.value[e].content=u.value.content,f.value[e].desc=u.value.desc);const n={id:Number(u.value.id),title:String(u.value.title),desc:String(u.value.desc),content:String(u.value.content)};await d.post("/admin/richtext/update",n)}},$=()=>{w.value=!1},B=_(!1),C=_("");_(!1);const j=()=>{B.value=!0},P=async function(){const n={content:C.value,title:"",desc:""},o=(await d.post("/admin/richtext/add",n)).data.id,t={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(o)};await d.post("/admin/lesson/work/requirement/update",t)},G=()=>{w.value=!1};(async function(){var n;try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId)},o=await d.post("/admin/lesson/content",e);for(let t=0;t<((n=o.data)==null?void 0:n.length);t+=1)f.value.push({id:o.data[t].resource_id,title:o.data[t].title,desc:o.data[t].desc,content:o.data[t].content})}catch(e){throw console.log(e),e}})();const y=_([]),E=_([]),F=_([]),J=async function(n,e){try{const o=n.data[0].id,t={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(o),resource_index:Number(0)};if(e===1){y.value.push({uid:n.data[0].id,name:n.data[0].url,url:n.data[0].full_url});const c=await d.post("/admin/lesson/refer/add",t)}if(e===2){E.value.push({uid:n.data[0].id,name:n.data[0].url,url:n.data[0].full_url});const c=await d.post("admin/lesson/experiment/add",t)}if(e===3){F.value.push({uid:n.data[0].id,name:n.data[0].url,url:n.data[0].full_url});const c=await d.post("admin/lesson/work/add",t)}}catch(o){throw console.log(o),o}},k=function(n,e){var o;for(let t=0;t<((o=n.value)==null?void 0:o.length);t+=1)if(n.value[t].uid===e)return n.value.splice(t,1),!0;return!1},W=async function(n){try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId),resource_id:Number(n)};if(k(y,n)){const o=await d.post("/admin/lesson/refer/del",e)}if(k(E,n)){const o=await d.post("/admin/lesson/experiment/del",e)}if(k(F,n)){const o=await d.post("/admin/lesson/work/del",e)}}catch(e){throw console.log(e),e}};(async function(){var n;try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId)},o=await d.post("admin/lesson/refer",e);for(let t=0;t<((n=o.data)==null?void 0:n.length);t+=1)y.value.push({uid:o.data[t].resource_id,name:o.data[t].title,url:o.data[t].content})}catch(e){throw console.log(e),e}})(),async function(){var n;try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId)},o=await d.post("admin/lesson/experiment",e);for(let t=0;t<((n=o.data)==null?void 0:n.length);t+=1)E.value.push({uid:o.data[t].resource_id,name:o.data[t].title,url:o.data[t].content})}catch(e){throw console.log(e),e}}(),async function(){var n;try{const e={course_id:Number(i.params.courseId),lesson_id:Number(i.params.chapterId)},o=await d.post("admin/lesson/work",e);for(let c=0;c<((n=o.data)==null?void 0:n.length);c+=1)F.value.push({uid:o.data[c].resource_id,name:o.data[c].title,url:o.data[c].content});const t=await d.post("/admin/lesson/work/requirement",e);C.value=t.data.content}catch(e){throw console.log(e),e}}();let N=1;const X=n=>{N=1},K=n=>{N=2},Q=n=>{N=3},q=n=>{const{onProgress:e,onError:o,onSuccess:t,fileItem:c,name:m}=n,p=new XMLHttpRequest;p.upload&&(p.upload.onprogress=function(h){let v;h.total>0&&(v=h.loaded/h.total),e(v,h)}),p.onerror=function(v){o(v)},p.onload=function(){if(p.status<200||p.status>=300)return o(p.responseText);const v=JSON.parse(p.responseText);return J(v,N),t(p.response)};const b=new FormData,M=String(Z());return b.append(m||"file",c.file),p.open("post","/admin/upload_files",!0),p.setRequestHeader("Authorization",M),p.send(b),{abort(){p.abort()}}},A=n=>{const{uid:e}=n;return W(e),new Promise((o,t)=>{S.confirm({title:"on-before-remove",content:`\u786E\u8BA4\u5220\u9664 ${n.name}`,onOk:()=>o(!0)})})};return(n,e)=>{const o=ie("Breadcrumb"),t=re,c=ae,m=ce,p=ne,b=oe,M=me,h=le,v=ue,V=S;return de(),se("div",he,[a(o,{items:["menu.mSimu","menu.mSimu.chapterDetailEdit"]},null,8,["items"]),a(h,null,{default:l(()=>[a(M,null,{default:l(()=>[ge,g("div",we,[a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[r(" \u6559\u5B66\u5185\u5BB9: ")]),_:1}),a(t,null,{default:l(()=>[g("div",be,[a(m,null,{default:l(()=>[a(t,{span:2},{default:l(()=>[a(c,{type:"primary",onClick:e[0]||(e[0]=s=>O())},{default:l(()=>[r(" \u589E\u52A0 ")]),_:1})]),_:1})]),_:1}),a(p,{columns:R,data:f.value,pagination:D},{edit:l(({record:s})=>[a(c,{onClick:Y=>z(s.id,s.title,s.content,s.desc)},{default:l(()=>[r("\u4FEE\u6539")]),_:2},1032,["onClick"])]),delete:l(({record:s})=>[a(c,{onClick:Y=>n.$modal.info({title:"\u5220\u9664",content:s.id,onOk:()=>T(s.id)})},{default:l(()=>[r("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1},8,["data"])])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[r(" \u6559\u5B66\u53C2\u8003\u8D44\u6E90: ")]),_:1}),a(t,null,{default:l(()=>[g("div",Ce,[a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[a(b,{"custom-request":q,"file-list":y.value,onBeforeRemove:A,onChange:X},null,8,["file-list"])]),_:1})]),_:1})])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[r(" \u505A\u5B9E\u9A8C: ")]),_:1}),a(t,null,{default:l(()=>[g("div",Ie,[a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[a(b,{"custom-request":q,"file-list":E.value,onBeforeRemove:A,onChange:K},null,8,["file-list"])]),_:1})]),_:1})])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[r(" \u5E03\u7F6E\u4F5C\u4E1A: ")]),_:1}),a(t,null,{default:l(()=>[g("div",ye,[a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[r(" \u4F5C\u4E1A\u8981\u6C42 ")]),_:1}),a(t,{span:4},{default:l(()=>[a(b,{"custom-request":q,"file-list":F.value,onBeforeRemove:A,onChange:Q},null,8,["file-list"])]),_:1})]),_:1})])]),_:1}),a(t,null,{default:l(()=>[g("div",Ee,[a(m,null,{default:l(()=>[a(t,null,{default:l(()=>[r(" \u4F5C\u4E1A\u8BF4\u660E ")]),_:1}),a(t,{span:4},{default:l(()=>[a(c,{type:"primary",onClick:e[1]||(e[1]=s=>j())},{default:l(()=>[r(" \u7F16\u8F91\u4F5C\u4E1A\u8BF4\u660E ")]),_:1})]),_:1}),a(t,null,{default:l(()=>[g("p",{innerHTML:C.value},null,8,Fe)]),_:1})]),_:1})])]),_:1})]),_:1})])]),_:1})]),_:1}),a(V,{visible:w.value,"onUpdate:visible":e[5]||(e[5]=s=>w.value=s),width:"auto",onOk:U,onCancel:$},{title:l(()=>[r(" \u65B0\u589E/\u7F16\u8F91\u6559\u5B66\u5185\u5BB9 ")]),default:l(()=>[a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[r("\u6807\u9898\uFF1A")]),_:1}),a(t,{span:4},{default:l(()=>[a(v,{modelValue:u.value.title,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.title=s),style:{width:"320px"},"allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[r("\u63CF\u8FF0\uFF1A")]),_:1}),a(t,{span:4},{default:l(()=>[a(v,{modelValue:u.value.desc,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.desc=s),style:{width:"320px"},"allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[r("\u5185\u5BB9\uFF1A")]),_:1}),a(t,null,{default:l(()=>[a(L(H),{modelValue:u.value.content,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.content=s),"api-key":"p33s220d86w6vicquiqrth23ziuycnagjsyzfsa18stpjzpt",init:{plugins:"wordcount"},"initial-value":"Once upon a time..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["visible"]),a(V,{visible:B.value,"onUpdate:visible":e[7]||(e[7]=s=>B.value=s),width:"auto",onOk:P,onCancel:G},{title:l(()=>[r(" \u65B0\u589E/\u7F16\u8F91\u4F5C\u4E1A\u8BF4\u660E ")]),default:l(()=>[a(m,null,{default:l(()=>[a(t,{span:4},{default:l(()=>[r("\u5185\u5BB9\uFF1A")]),_:1}),a(t,null,{default:l(()=>[a(L(H),{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=s=>C.value=s),"api-key":"p33s220d86w6vicquiqrth23ziuycnagjsyzfsa18stpjzpt",init:{plugins:"wordcount"},"initial-value":"Once upon a time..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["visible"])])}}});const Pe=ee(Ne,[["__scopeId","data-v-4ff007ef"]]);export{Pe as default};
